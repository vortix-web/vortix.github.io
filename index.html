<!doctype html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تحويل صورة إلى رابط PNG</title>
<style>
  body { font-family: Arial; direction: rtl; padding: 20px; }
  .box { max-width: 500px; margin: auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }
  .result { margin-top: 15px; word-break: break-all; }
  img { max-width: 100%; margin-top: 10px; display: none; }
</style>
</head>

<body>
<div class="box">
  <h2>تحويل صورة إلى رابط PNG مباشر</h2>
  <input type="file" id="fileInput" accept="image/*" />
  <button onclick="convertAndUpload()">رفع وتحويل</button>

  <div class="result" id="result"></div>
  <img id="preview" />
</div>

<script>
async function convertAndUpload() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("اختر صورة أولاً");

  // تحويل الصورة إلى PNG عبر Canvas
  const pngBlob = await convertToPng(file);
  const base64 = await blobToBase64(pngBlob);

  document.getElementById("result").innerHTML = "جاري الرفع...";

  // رفع إلى ImgBB
  const apiKey = "YOUR_API_KEY"; // ضع مفتاحك هنا
  const formData = new FormData();
  formData.append("image", base64.split(",")[1]);

  const upload = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
    method: "POST",
    body: formData
  });

  const data = await upload.json();

  if (data.success) {
    const url = data.data.url;
    document.getElementById("result").innerHTML =
      `<strong>تم بنجاح:</strong><br><a href="${url}" target="_blank">${url}</a>`;
      
    const img = document.getElementById("preview");
    img.src = url;
    img.style.display = "block";
  } else {
    document.getElementById("result").innerHTML = "فشل الرفع!";
  }
}

// تحويل لأي صورة إلى PNG عبر Canvas
function convertToPng(file) {
  return new Promise((resolve) => {
    const img = new Image();
    const reader = new FileReader();

    reader.onload = () => {
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);

        canvas.toBlob((blob) => resolve(blob), "image/png", 1.0);
      };
      img.src = reader.result;
    };

    reader.readAsDataURL(file);
  });
}

// تحويل blob إلى base64
function blobToBase64(blob) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.readAsDataURL(blob);
  });
}
</script>

</body>
</html>
